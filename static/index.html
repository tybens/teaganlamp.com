<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    

    <title>Teagan Lamp</title>
    <link rel="stylesheet" href="styles.css" type="text/css">
  </head>
  <body>
    <div id="page-container">
      <div id="content-wrap">
    <div class="grid-container">
      <div class="intro-text">
        <h1>teagan lamp</h1>
        <p style="margin-top: 10px;">control teagan lamp from the comfort of ANYWHERE</p>
      </div>
      <div class="div-lamp-button">
        <button id="lamp-button">Off</button>
      </div>


  </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.1/socket.io.min.js" integrity="sha512-/WwtKR6NnHomLo0O4w9QKc1INTPEJs7ko6u2aBTA1paPldhPl8LtXsi7a35iEZ69+9P5dcgVNESG8hrP4Y2t3w==" crossorigin="anonymous"></script>
    <script type="text/javascript">
      // this is your arduino server
      let server =  window.location.hostname === '127.0.0.1' ? 'http://127.0.0.1:5000':'https://teaganlamp.com';
      var socket = io.connect(server);


      const lampButton = document.getElementById('lamp-button');

      // need to fetch status of lamp (on or off) from server
      socket.on('lamp changed', function(isLampOn) {
        // hopefully this updates my client isLampOn variable
        changeLampButton(isLampOn)
        //console.log('server lamp is ' + String(isLampOn))
      });
      var isLampOn;
      getLamp()
      async function getLamp() {
        fetch(`${server}/getLamp`).then(response => response.json())
          .then(response => {
            isLampOn = response.isLampOn;
            changeLampButton(isLampOn);
            console.log('get lamp returned: '+ String(isLampOn))
          }).catch((error) => {
            console.error('Error:', error);
        });
      }


      async function changeLampButton(isLampOn) {
        if (!isLampOn) {
          lampButton.innerText = 'On';
          lampButton.style.backgroundColor = 'grey';
          lampButton.style.color = 'white';
        } else {
          lampButton.innerText = 'Off';
          lampButton.style.color = 'black';
          lampButton.style.backgroundColor = 'pink';
        }
      }

      async function doLamp() {
        // this oldLampOn shouldn't be relevant now that we have web socket, but I'll keep it just in case
        isLampOn = (!isLampOn)
        changeLampButton(isLampOn)
        // fetch request to change lamp
        fetch(`${server}/changeLamp`).then(response => response.json())
          .then(response => {
          }).catch((error) => {
            console.error('Error:', error);
          });
          } 

      lampButton.addEventListener('click', doLamp)

    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7JF3B0HFYJ');
    </script>
  </body>
</html>
